<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8"/>
  
  <style>
    body {
      font-family: "Helvetica Neue", arial, sans-serif;
      font-size: 14px;
      line-height: 1.6;
      padding-top: 10px;
      padding-bottom: 10px;
      background-color: white;
      padding: 30px;
      color: #333;
      border: 1px solid #aaa;
      max-width: 900px;
      margin: 20px auto;
    }

    body > *:first-child {
      margin-top: 0 !important;
    }

    body > *:last-child {
      margin-bottom: 0 !important;
    }

    a {
      color: #4183C4;
      text-decoration: none;
    }

    a.absent {
      color: #cc0000;
    }

    a.anchor {
      display: block;
      padding-left: 30px;
      margin-left: -30px;
      cursor: pointer;
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
    }

    h1, h2, h3, h4, h5, h6 {
      margin: 20px 0 10px;
      padding: 0;
      font-weight: bold;
      -webkit-font-smoothing: antialiased;
      cursor: text;
      position: relative;
    }

    h2:first-child, h1:first-child, h1:first-child + h2, h3:first-child, h4:first-child, h5:first-child, h6:first-child {
      margin-top: 0;
      padding-top: 0;
    }

    h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
      text-decoration: none;
    }

    h1 tt, h1 code {
      font-size: inherit;
    }

    h2 tt, h2 code {
      font-size: inherit;
    }

    h3 tt, h3 code {
      font-size: inherit;
    }

    h4 tt, h4 code {
      font-size: inherit;
    }

    h5 tt, h5 code {
      font-size: inherit;
    }

    h6 tt, h6 code {
      font-size: inherit;
    }

    h1 {
      font-size: 28px;
      color: black;
    }

    h2 {
      font-size: 24px;
      border-bottom: 1px solid #cccccc;
      color: black;
    }

    h3 {
      font-size: 18px;
    }

    h4 {
      font-size: 16px;
    }

    h5 {
      font-size: 14px;
    }

    h6 {
      color: #777777;
      font-size: 14px;
    }

    p, blockquote, ul, ol, dl, li, table, pre {
      margin: 3px 0;
    }

    hr {
      background: transparent url("http://tinyurl.com/bq5kskr") repeat-x 0 0;
      border: 0 none;
      color: #cccccc;
      height: 4px;
      padding: 0;
    }

    body > h2:first-child {
      margin-top: 0;
      padding-top: 0;
    }

    body > h1:first-child {
      margin-top: 0;
      padding-top: 0;
    }

    body > h1:first-child + h2 {
      margin-top: 0;
      padding-top: 0;
    }

    body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
      margin-top: 0;
      padding-top: 0;
    }

    a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
      margin-top: 0;
      padding-top: 0;
    }

    h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
      margin-top: 0;
    }

    li p.first {
      display: inline-block;
    }

    ul, ol {
      padding-left: 30px;
    }

    ul :first-child, ol :first-child {
      margin-top: 0;
    }

    ul :last-child, ol :last-child {
      margin-bottom: 0;
    }

    dl {
      padding: 0;
    }

    dl dt {
      font-size: 14px;
      font-weight: bold;
      font-style: italic;
      padding: 0;
      margin: 15px 0 5px;
    }

    dl dt:first-child {
      padding: 0;
    }

    dl dt > :first-child {
      margin-top: 0;
    }

    dl dt > :last-child {
      margin-bottom: 0;
    }

    dl dd {
      margin: 0 0 15px;
      padding: 0 15px;
    }

    dl dd > :first-child {
      margin-top: 0;
    }

    dl dd > :last-child {
      margin-bottom: 0;
    }

    blockquote {
      border-left: 4px solid #dddddd;
      padding: 0 15px;
      color: #777777;
    }

    blockquote > :first-child {
      margin-top: 0;
    }

    blockquote > :last-child {
      margin-bottom: 0;
    }

    table {
      padding: 0;
    }
    table tr {
      border-top: 1px solid #cccccc;
      background-color: white;
      margin: 0;
      padding: 0;
    }

    table tr:nth-child(2n) {
      background-color: #f8f8f8;
    }

    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px;
    }

    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px;
    }

    table tr th :first-child, table tr td :first-child {
      margin-top: 0;
    }

    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0;
    }

    img {
      max-width: 100%;
    }

    span.frame {
      display: block;
      overflow: hidden;
    }

    span.frame > span {
      border: 1px solid #dddddd;
      display: block;
      float: left;
      overflow: hidden;
      margin: 13px 0 0;
      padding: 7px;
      width: auto;
    }

    span.frame span img {
      display: block;
      float: left;
    }

    span.frame span span {
      clear: both;
      color: #333333;
      display: block;
      padding: 5px 0 0;
    }

    span.align-center {
      display: block;
      overflow: hidden;
      clear: both;
    }

    span.align-center > span {
      display: block;
      overflow: hidden;
      margin: 13px auto 0;
      text-align: center;
    }

    span.align-center span img {
      margin: 0 auto;
      text-align: center;
    }

    span.align-right {
      display: block;
      overflow: hidden;
      clear: both;
    }

    span.align-right > span {
      display: block;
      overflow: hidden;
      margin: 13px 0 0;
      text-align: right;
    }

    span.align-right span img {
      margin: 0;
      text-align: right;
    }

    span.float-left {
      display: block;
      margin-right: 13px;
      overflow: hidden;
      float: left;
    }

    span.float-left span {
      margin: 13px 0 0;
    }

    span.float-right {
      display: block;
      margin-left: 13px;
      overflow: hidden;
      float: right;
    }

    span.float-right > span {
      display: block;
      overflow: hidden;
      margin: 13px auto 0;
      text-align: right;
    }

    code, tt {
      font-family: "Lucida Console", "Courier New", courier;
      font-size: 12px;
      margin: 0 2px;
      padding: 3px 5px;
      white-space: nowrap;
      border: 1px solid #eaeaea;
      background-color: #f8f8f8;
      border-radius: 3px;
    }

    pre code {
      margin: 0;
      padding: 0;
      white-space: pre;
      border: none;
      background: transparent;
    }

    .highlight pre {
      background-color: #f8f8f8;
      border: 1px solid #cccccc;
      font-size: 13px;
      line-height: 19px;
      overflow: auto;
      padding: 6px 10px;
      border-radius: 3px;
    }

    pre {
      background-color: #f8f8f8;
      border: 1px solid #cccccc;
      font-size: 13px;
      line-height: 19px;
      overflow: auto;
      padding: 6px 10px;
      border-radius: 3px;
    }

    pre code, pre tt {
      background-color: transparent;
      border: none;
    }

    span.line-numbers {
      margin-right: 10px;
    }

    img.logo {
      display: block;
      margin: 10px auto;
    }

    h1.logo {
      text-align: center;
      font-size: 40px;
    }
  </style>
</head>
<body>
  <div id="containter">
    
    <h1 id="configuring-rails-applications">Configuring Rails Applications</h1>

<p>This guide covers the configuration and initialization features available to Rails applications.</p>

<p>After reading this guide, you will know:</p>

<ul>
  <li>How to adjust the behavior of your Rails applications.</li>
  <li>How to add additional code to be run at application start time.</li>
</ul>

<hr />

<h2 id="locations-for-initialization-code">Locations for Initialization Code</h2>

<p>Rails offers four standard spots to place initialization code:</p>

<ul>
  <li><code>config/application.rb</code></li>
  <li>Environment-specific configuration files</li>
  <li>Initializers</li>
  <li>After-initializers</li>
</ul>

<h2 id="running-code-before-rails">Running Code Before Rails</h2>

<p>In the rare event that your application needs to run some code before Rails itself is loaded, put it above the call to <code>require 'rails/all'</code> in <code>config/application.rb</code>.</p>

<h2 id="configuring-rails-components">Configuring Rails Components</h2>

<p>In general, the work of configuring Rails means configuring the components of Rails, as well as configuring Rails itself. The configuration file <code>config/application.rb</code> and environment-specific configuration files (such as <code>config/environments/production.rb</code>) allow you to specify the various settings that you want to pass down to all of the components.</p>

<p>For example, the <code>config/application.rb</code> file includes this setting:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>config.autoload_paths += <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">%W(</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>config.root<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">/extras</span><span style="color:#710">)</span></span>
</pre></div>
</div>
</div>

<p>This is a setting for Rails itself. If you want to pass settings to individual Rails components, you can do so via the same <code>config</code> object in <code>config/application.rb</code>:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>config.active_record.schema_format = <span style="color:#A60">:ruby</span>
</pre></div>
</div>
</div>

<p>Rails will use that particular setting to configure Active Record.</p>

<h3 id="rails-general-configuration">Rails General Configuration</h3>

<p>These configuration methods are to be called on a <code>Rails::Railtie</code> object, such as a subclass of <code>Rails::Engine</code> or <code>Rails::Application</code>.</p>

<ul>
  <li>
    <p><code>config.after_initialize</code> takes a block which will be run <em>after</em> Rails has finished initializing the application. That includes the initialization of the framework itself, engines, and all the application’s initializers in <code>config/initializers</code>. Note that this block <em>will</em> be run for rake tasks. Useful for configuring values set up by other initializers:</p>

    <p>~~~ruby
  config.after_initialize do
    ActionView::Base.sanitized_allowed_tags.delete ‘div’
  end
  ~~~</p>
  </li>
  <li>
    <p><code>config.asset_host</code> sets the host for the assets. Useful when CDNs are used for hosting assets, or when you want to work around the concurrency constraints built-in in browsers using different domain aliases. Shorter version of <code>config.action_controller.asset_host</code>.</p>
  </li>
  <li>
    <p><code>config.autoload_once_paths</code> accepts an array of paths from which Rails will autoload constants that won’t be wiped per request. Relevant if <code>config.cache_classes</code> is false, which is the case in development mode by default. Otherwise, all autoloading happens only once. All elements of this array must also be in <code>autoload_paths</code>. Default is an empty array.</p>
  </li>
  <li>
    <p><code>config.autoload_paths</code> accepts an array of paths from which Rails will autoload constants. Default is all directories under <code>app</code>.</p>
  </li>
  <li>
    <p><code>config.cache_classes</code> controls whether or not application classes and modules should be reloaded on each request. Defaults to false in development mode, and true in test and production modes.</p>
  </li>
  <li>
    <p><code>config.action_view.cache_template_loading</code> controls whether or not templates should be reloaded on each request. Defaults to whatever is set for <code>config.cache_classes</code>.</p>
  </li>
  <li>
    <p><code>config.beginning_of_week</code> sets the default beginning of week for the
application. Accepts a valid week day symbol (e.g. <code>:monday</code>).</p>
  </li>
  <li>
    <p><code>config.cache_store</code> configures which cache store to use for Rails caching. Options include one of the symbols <code>:memory_store</code>, <code>:file_store</code>, <code>:mem_cache_store</code>, <code>:null_store</code>, or an object that implements the cache API. Defaults to <code>:file_store</code> if the directory <code>tmp/cache</code> exists, and to <code>:memory_store</code> otherwise.</p>
  </li>
  <li>
    <p><code>config.colorize_logging</code> specifies whether or not to use ANSI color codes when logging information. Defaults to true.</p>
  </li>
  <li>
    <p><code>config.consider_all_requests_local</code> is a flag. If true then any error will cause detailed debugging information to be dumped in the HTTP response, and the <code>Rails::Info</code> controller will show the application runtime context in <code>/rails/info/properties</code>. True by default in development and test environments, and false in production mode. For finer-grained control, set this to false and implement <code>local_request?</code> in controllers to specify which requests should provide debugging information on errors.</p>
  </li>
  <li>
    <p><code>config.console</code> allows you to set class that will be used as console you run <code>rails console</code>. It’s best to run it in <code>console</code> block:</p>

    <p>~~~ruby
  console do
    # this block is called only when running console,
    # so we can safely require pry here
    require “pry”
    config.console = Pry
  end
  ~~~</p>
  </li>
  <li>
    <p><code>config.dependency_loading</code> is a flag that allows you to disable constant autoloading setting it to false. It only has effect if <code>config.cache_classes</code> is true, which it is by default in production mode.</p>
  </li>
  <li>
    <p><code>config.eager_load</code> when true, eager loads all registered <code>config.eager_load_namespaces</code>. This includes your application, engines, Rails frameworks and any other registered namespace.</p>
  </li>
  <li>
    <p><code>config.eager_load_namespaces</code> registers namespaces that are eager loaded when <code>config.eager_load</code> is true. All namespaces in the list must respond to the <code>eager_load!</code> method.</p>
  </li>
  <li>
    <p><code>config.eager_load_paths</code> accepts an array of paths from which Rails will eager load on boot if cache classes is enabled. Defaults to every folder in the <code>app</code> directory of the application.</p>
  </li>
  <li>
    <p><code>config.encoding</code> sets up the application-wide encoding. Defaults to UTF-8.</p>
  </li>
  <li>
    <p><code>config.exceptions_app</code> sets the exceptions application invoked by the ShowException middleware when an exception happens. Defaults to <code>ActionDispatch::PublicExceptions.new(Rails.public_path)</code>.</p>
  </li>
  <li>
    <p><code>config.file_watcher</code> the class used to detect file updates in the filesystem when <code>config.reload_classes_only_on_change</code> is true. Must conform to <code>ActiveSupport::FileUpdateChecker</code> API.</p>
  </li>
  <li>
    <p><code>config.filter_parameters</code> used for filtering out the parameters that
you don’t want shown in the logs, such as passwords or credit card
numbers. New applications filter out passwords by adding the following <code>config.filter_parameters+=[:password]</code> in <code>config/initializers/filter_parameter_logging.rb</code>.</p>
  </li>
  <li>
    <p><code>config.force_ssl</code> forces all requests to be under HTTPS protocol by using <code>ActionDispatch::SSL</code> middleware.</p>
  </li>
  <li>
    <p><code>config.log_formatter</code> defines the formatter of the Rails logger. This option defaults to an instance of <code>ActiveSupport::Logger::SimpleFormatter</code> for all modes except production, where it defaults to <code>Logger::Formatter</code>.</p>
  </li>
  <li>
    <p><code>config.log_level</code> defines the verbosity of the Rails logger. This option defaults to <code>:debug</code> for all environments.</p>
  </li>
  <li>
    <p><code>config.log_tags</code> accepts a list of methods that the <code>request</code> object responds to. This makes it easy to tag log lines with debug information like subdomain and request id - both very helpful in debugging multi-user production applications.</p>
  </li>
  <li>
    <p><code>config.logger</code> accepts a logger conforming to the interface of Log4r or the default Ruby <code>Logger</code> class. Defaults to an instance of <code>ActiveSupport::Logger</code>.</p>
  </li>
  <li>
    <p><code>config.middleware</code> allows you to configure the application’s middleware. This is covered in depth in the <a href="#configuring-middleware">Configuring Middleware</a> section below.</p>
  </li>
  <li>
    <p><code>config.reload_classes_only_on_change</code> enables or disables reloading of classes only when tracked files change. By default tracks everything on autoload paths and is set to true. If <code>config.cache_classes</code> is true, this option is ignored.</p>
  </li>
  <li>
    <p><code>secrets.secret_key_base</code> is used for specifying a key which allows sessions for the application to be verified against a known secure key to prevent tampering. Applications get <code>secrets.secret_key_base</code> initialized to a random key present in <code>config/secrets.yml</code>.</p>
  </li>
  <li>
    <p><code>config.serve_static_files</code> configures Rails itself to serve static files. Defaults to true, but in the production environment is turned off as the server software (e.g. NGINX or Apache) used to run the application should serve static assets instead. Unlike the default setting set this to true when running (absolutely not recommended!) or testing your app in production mode using WEBrick. Otherwise you won’t be able use page caching and requests for files that exist regularly under the public directory will anyway hit your Rails app.</p>
  </li>
  <li>
    <p><code>config.session_store</code> is usually set up in <code>config/initializers/session_store.rb</code> and specifies what class to use to store the session. Possible values are <code>:cookie_store</code> which is the default, <code>:mem_cache_store</code>, and <code>:disabled</code>. The last one tells Rails not to deal with sessions. Custom session stores can also be specified:</p>

    <p>~~~ruby
  config.session_store :my_custom_store
  ~~~</p>

    <p>This custom store must be defined as <code>ActionDispatch::Session::MyCustomStore</code>.</p>
  </li>
  <li>
    <p><code>config.time_zone</code> sets the default time zone for the application and enables time zone awareness for Active Record.</p>
  </li>
</ul>

<h3 id="configuring-assets">Configuring Assets</h3>

<ul>
  <li>
    <p><code>config.assets.enabled</code> a flag that controls whether the asset
pipeline is enabled. It is set to true by default.</p>
  </li>
  <li>
    <p><code>config.assets.raise_runtime_errors</code> Set this flag to <code>true</code> to enable additional runtime error checking. Recommended in <code>config/environments/development.rb</code> to minimize unexpected behavior when deploying to <code>production</code>.</p>
  </li>
  <li>
    <p><code>config.assets.compress</code> a flag that enables the compression of compiled assets. It is explicitly set to true in <code>config/environments/production.rb</code>.</p>
  </li>
  <li>
    <p><code>config.assets.css_compressor</code> defines the CSS compressor to use. It is set by default by <code>sass-rails</code>. The unique alternative value at the moment is <code>:yui</code>, which uses the <code>yui-compressor</code> gem.</p>
  </li>
  <li>
    <p><code>config.assets.js_compressor</code> defines the JavaScript compressor to use. Possible values are <code>:closure</code>, <code>:uglifier</code> and <code>:yui</code> which require the use of the <code>closure-compiler</code>, <code>uglifier</code> or <code>yui-compressor</code> gems respectively.</p>
  </li>
  <li>
    <p><code>config.assets.paths</code> contains the paths which are used to look for assets. Appending paths to this configuration option will cause those paths to be used in the search for assets.</p>
  </li>
  <li>
    <p><code>config.assets.precompile</code> allows you to specify additional assets (other than <code>application.css</code> and <code>application.js</code>) which are to be precompiled when <code>rake assets:precompile</code> is run.</p>
  </li>
  <li>
    <p><code>config.assets.prefix</code> defines the prefix where assets are served from. Defaults to <code>/assets</code>.</p>
  </li>
  <li>
    <p><code>config.assets.manifest</code> defines the full path to be used for the asset precompiler’s manifest file. Defaults to a file named <code>manifest-&lt;random&gt;.json</code> in the <code>config.assets.prefix</code> directory within the public folder.</p>
  </li>
  <li>
    <p><code>config.assets.digest</code> enables the use of MD5 fingerprints in asset names. Set to <code>true</code> by default in <code>production.rb</code> and <code>development.rb</code>.</p>
  </li>
  <li>
    <p><code>config.assets.debug</code> disables the concatenation and compression of assets. Set to <code>true</code> by default in <code>development.rb</code>.</p>
  </li>
  <li>
    <p><code>config.assets.cache_store</code> defines the cache store that Sprockets will use. The default is the Rails file store.</p>
  </li>
  <li>
    <p><code>config.assets.version</code> is an option string that is used in MD5 hash generation. This can be changed to force all files to be recompiled.</p>
  </li>
  <li>
    <p><code>config.assets.compile</code> is a boolean that can be used to turn on live Sprockets compilation in production.</p>
  </li>
  <li>
    <p><code>config.assets.logger</code> accepts a logger conforming to the interface of Log4r or the default Ruby <code>Logger</code> class. Defaults to the same configured at <code>config.logger</code>. Setting <code>config.assets.logger</code> to false will turn off served assets logging.</p>
  </li>
</ul>

<h3 id="configuring-generators">Configuring Generators</h3>

<p>Rails allows you to alter what generators are used with the <code>config.generators</code> method. This method takes a block:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>config.generators <span style="color:#080;font-weight:bold">do</span> |g|
  g.orm <span style="color:#A60">:active_record</span>
  g.test_framework <span style="color:#A60">:test_unit</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>The full set of methods that can be used in this block are as follows:</p>

<ul>
  <li><code>assets</code> allows to create assets on generating a scaffold. Defaults to <code>true</code>.</li>
  <li><code>force_plural</code> allows pluralized model names. Defaults to <code>false</code>.</li>
  <li><code>helper</code> defines whether or not to generate helpers. Defaults to <code>true</code>.</li>
  <li><code>integration_tool</code> defines which integration tool to use. Defaults to <code>nil</code>.</li>
  <li><code>javascripts</code> turns on the hook for JavaScript files in generators. Used in Rails for when the <code>scaffold</code> generator is run. Defaults to <code>true</code>.</li>
  <li><code>javascript_engine</code> configures the engine to be used (for eg. coffee) when generating assets. Defaults to <code>nil</code>.</li>
  <li><code>orm</code> defines which orm to use. Defaults to <code>false</code> and will use Active Record by default.</li>
  <li><code>resource_controller</code> defines which generator to use for generating a controller when using <code>rails generate resource</code>. Defaults to <code>:controller</code>.</li>
  <li><code>scaffold_controller</code> different from <code>resource_controller</code>, defines which generator to use for generating a <em>scaffolded</em> controller when using <code>rails generate scaffold</code>. Defaults to <code>:scaffold_controller</code>.</li>
  <li><code>stylesheets</code> turns on the hook for stylesheets in generators. Used in Rails for when the <code>scaffold</code> generator is run, but this hook can be used in other generates as well. Defaults to <code>true</code>.</li>
  <li><code>stylesheet_engine</code> configures the stylesheet engine (for eg. sass) to be used when generating assets. Defaults to <code>:css</code>.</li>
  <li><code>test_framework</code> defines which test framework to use. Defaults to <code>false</code> and will use Test::Unit by default.</li>
  <li><code>template_engine</code> defines which template engine to use, such as ERB or Haml. Defaults to <code>:erb</code>.</li>
</ul>

<h3 id="configuring-middleware">Configuring Middleware</h3>

<p>Every Rails application comes with a standard set of middleware which it uses in this order in the development environment:</p>

<ul>
  <li><code>ActionDispatch::SSL</code> forces every request to be under HTTPS protocol. Will be available if <code>config.force_ssl</code> is set to <code>true</code>. Options passed to this can be configured by using <code>config.ssl_options</code>.</li>
  <li><code>ActionDispatch::Static</code> is used to serve static assets. Disabled if <code>config.serve_static_assets</code> is <code>false</code>.</li>
  <li><code>Rack::Lock</code> wraps the app in mutex so it can only be called by a single thread at a time. Only enabled when <code>config.cache_classes</code> is <code>false</code>.</li>
  <li><code>ActiveSupport::Cache::Strategy::LocalCache</code> serves as a basic memory backed cache. This cache is not thread safe and is intended only for serving as a temporary memory cache for a single thread.</li>
  <li><code>Rack::Runtime</code> sets an <code>X-Runtime</code> header, containing the time (in seconds) taken to execute the request.</li>
  <li><code>Rails::Rack::Logger</code> notifies the logs that the request has begun. After request is complete, flushes all the logs.</li>
  <li><code>ActionDispatch::ShowExceptions</code> rescues any exception returned by the application and renders nice exception pages if the request is local or if <code>config.consider_all_requests_local</code> is set to <code>true</code>. If <code>config.action_dispatch.show_exceptions</code> is set to <code>false</code>, exceptions will be raised regardless.</li>
  <li><code>ActionDispatch::RequestId</code> makes a unique X-Request-Id header available to the response and enables the <code>ActionDispatch::Request#uuid</code> method.</li>
  <li><code>ActionDispatch::RemoteIp</code> checks for IP spoofing attacks and gets valid <code>client_ip</code> from request headers. Configurable with the <code>config.action_dispatch.ip_spoofing_check</code>, and <code>config.action_dispatch.trusted_proxies</code> options.</li>
  <li><code>Rack::Sendfile</code> intercepts responses whose body is being served from a file and replaces it with a server specific X-Sendfile header. Configurable with <code>config.action_dispatch.x_sendfile_header</code>.</li>
  <li><code>ActionDispatch::Callbacks</code> runs the prepare callbacks before serving the request.</li>
  <li><code>ActiveRecord::ConnectionAdapters::ConnectionManagement</code> cleans active connections after each request, unless the <code>rack.test</code> key in the request environment is set to <code>true</code>.</li>
  <li><code>ActiveRecord::QueryCache</code> caches all SELECT queries generated in a request. If any INSERT or UPDATE takes place then the cache is cleaned.</li>
  <li><code>ActionDispatch::Cookies</code> sets cookies for the request.</li>
  <li><code>ActionDispatch::Session::CookieStore</code> is responsible for storing the session in cookies. An alternate middleware can be used for this by changing the <code>config.action_controller.session_store</code> to an alternate value. Additionally, options passed to this can be configured by using <code>config.action_controller.session_options</code>.</li>
  <li><code>ActionDispatch::Flash</code> sets up the <code>flash</code> keys. Only available if <code>config.action_controller.session_store</code> is set to a value.</li>
  <li><code>ActionDispatch::ParamsParser</code> parses out parameters from the request into <code>params</code>.</li>
  <li><code>Rack::MethodOverride</code> allows the method to be overridden if <code>params[:_method]</code> is set. This is the middleware which supports the PATCH, PUT, and DELETE HTTP method types.</li>
  <li><code>Rack::Head</code> converts HEAD requests to GET requests and serves them as so.</li>
</ul>

<p>Besides these usual middleware, you can add your own by using the <code>config.middleware.use</code> method:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>config.middleware.use <span style="color:#036;font-weight:bold">Magical</span>::<span style="color:#036;font-weight:bold">Unicorns</span>
</pre></div>
</div>
</div>

<p>This will put the <code>Magical::Unicorns</code> middleware on the end of the stack. You can use <code>insert_before</code> if you wish to add a middleware before another.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>config.middleware.insert_before <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Head</span>, <span style="color:#036;font-weight:bold">Magical</span>::<span style="color:#036;font-weight:bold">Unicorns</span>
</pre></div>
</div>
</div>

<p>There’s also <code>insert_after</code> which will insert a middleware after another:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>config.middleware.insert_after <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Head</span>, <span style="color:#036;font-weight:bold">Magical</span>::<span style="color:#036;font-weight:bold">Unicorns</span>
</pre></div>
</div>
</div>

<p>Middlewares can also be completely swapped out and replaced with others:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>config.middleware.swap <span style="color:#036;font-weight:bold">ActionController</span>::<span style="color:#036;font-weight:bold">Failsafe</span>, <span style="color:#036;font-weight:bold">Lifo</span>::<span style="color:#036;font-weight:bold">Failsafe</span>
</pre></div>
</div>
</div>

<p>They can also be removed from the stack completely:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>config.middleware.delete <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Rack::MethodOverride</span><span style="color:#710">&quot;</span></span>
</pre></div>
</div>
</div>

<h3 id="configuring-i18n">Configuring i18n</h3>

<p>All these configuration options are delegated to the <code>I18n</code> library.</p>

<ul>
  <li>
    <p><code>config.i18n.available_locales</code> whitelists the available locales for the app. Defaults to all locale keys found in locale files, usually only <code>:en</code> on a new application.</p>
  </li>
  <li>
    <p><code>config.i18n.default_locale</code> sets the default locale of an application used for i18n. Defaults to <code>:en</code>.</p>
  </li>
  <li>
    <p><code>config.i18n.enforce_available_locales</code> ensures that all locales passed through i18n must be declared in the <code>available_locales</code> list, raising an <code>I18n::InvalidLocale</code> exception when setting an unavailable locale. Defaults to <code>true</code>. It is recommended not to disable this option unless strongly required, since this works as a security measure against setting any invalid locale from user input.</p>
  </li>
  <li>
    <p><code>config.i18n.load_path</code> sets the path Rails uses to look for locale files. Defaults to <code>config/locales/*.{yml,rb}</code>.</p>
  </li>
</ul>

<h3 id="configuring-active-record">Configuring Active Record</h3>

<p><code>config.active_record</code> includes a variety of configuration options:</p>

<ul>
  <li>
    <p><code>config.active_record.logger</code> accepts a logger conforming to the interface of Log4r or the default Ruby Logger class, which is then passed on to any new database connections made. You can retrieve this logger by calling <code>logger</code> on either an Active Record model class or an Active Record model instance. Set to <code>nil</code> to disable logging.</p>
  </li>
  <li>
    <p><code>config.active_record.primary_key_prefix_type</code> lets you adjust the naming for primary key columns. By default, Rails assumes that primary key columns are named <code>id</code> (and this configuration option doesn’t need to be set.) There are two other choices:
** <code>:table_name</code> would make the primary key for the Customer class <code>customerid</code>
** <code>:table_name_with_underscore</code> would make the primary key for the Customer class <code>customer_id</code></p>
  </li>
  <li>
    <p><code>config.active_record.table_name_prefix</code> lets you set a global string to be prepended to table names. If you set this to <code>northwest_</code>, then the Customer class will look for <code>northwest_customers</code> as its table. The default is an empty string.</p>
  </li>
  <li>
    <p><code>config.active_record.table_name_suffix</code> lets you set a global string to be appended to table names. If you set this to <code>_northwest</code>, then the Customer class will look for <code>customers_northwest</code> as its table. The default is an empty string.</p>
  </li>
  <li>
    <p><code>config.active_record.schema_migrations_table_name</code> lets you set a string to be used as the name of the schema migrations table.</p>
  </li>
  <li>
    <p><code>config.active_record.pluralize_table_names</code> specifies whether Rails will look for singular or plural table names in the database. If set to true (the default), then the Customer class will use the <code>customers</code> table. If set to false, then the Customer class will use the <code>customer</code> table.</p>
  </li>
  <li>
    <p><code>config.active_record.default_timezone</code> determines whether to use <code>Time.local</code> (if set to <code>:local</code>) or <code>Time.utc</code> (if set to <code>:utc</code>) when pulling dates and times from the database. The default is <code>:utc</code>.</p>
  </li>
  <li>
    <p><code>config.active_record.schema_format</code> controls the format for dumping the database schema to a file. The options are <code>:ruby</code> (the default) for a database-independent version that depends on migrations, or <code>:sql</code> for a set of (potentially database-dependent) SQL statements.</p>
  </li>
  <li>
    <p><code>config.active_record.timestamped_migrations</code> controls whether migrations are numbered with serial integers or with timestamps. The default is true, to use timestamps, which are preferred if there are multiple developers working on the same application.</p>
  </li>
  <li>
    <p><code>config.active_record.lock_optimistically</code> controls whether Active Record will use optimistic locking and is true by default.</p>
  </li>
  <li>
    <p><code>config.active_record.cache_timestamp_format</code> controls the format of the timestamp value in the cache key. Default is <code>:number</code>.</p>
  </li>
  <li>
    <p><code>config.active_record.record_timestamps</code> is a boolean value which controls whether or not timestamping of <code>create</code> and <code>update</code> operations on a model occur. The default value is <code>true</code>.</p>
  </li>
  <li>
    <p><code>config.active_record.partial_writes</code> is a boolean value and controls whether or not partial writes are used (i.e. whether updates only set attributes that are dirty). Note that when using partial writes, you should also use optimistic locking <code>config.active_record.lock_optimistically</code> since concurrent updates may write attributes based on a possibly stale read state. The default value is <code>true</code>.</p>
  </li>
  <li>
    <p><code>config.active_record.maintain_test_schema</code> is a boolean value which controls whether Active Record should try to keep your test database schema up-to-date with <code>db/schema.rb</code> (or <code>db/structure.sql</code>) when you run your tests. The default is true.</p>
  </li>
  <li>
    <p><code>config.active_record.dump_schema_after_migration</code> is a flag which
controls whether or not schema dump should happen (<code>db/schema.rb</code> or
<code>db/structure.sql</code>) when you run migrations. This is set to false in
<code>config/environments/production.rb</code> which is generated by Rails. The
default value is true if this configuration is not set.</p>
  </li>
</ul>

<p>The MySQL adapter adds one additional configuration option:</p>

<ul>
  <li><code>ActiveRecord::ConnectionAdapters::MysqlAdapter.emulate_booleans</code> controls whether Active Record will consider all <code>tinyint(1)</code> columns in a MySQL database to be booleans and is true by default.</li>
</ul>

<p>The schema dumper adds one additional configuration option:</p>

<ul>
  <li><code>ActiveRecord::SchemaDumper.ignore_tables</code> accepts an array of tables that should <em>not</em> be included in any generated schema file. This setting is ignored unless <code>config.active_record.schema_format == :ruby</code>.</li>
</ul>

<h3 id="configuring-action-controller">Configuring Action Controller</h3>

<p><code>config.action_controller</code> includes a number of configuration settings:</p>

<ul>
  <li>
    <p><code>config.action_controller.asset_host</code> sets the host for the assets. Useful when CDNs are used for hosting assets rather than the application server itself.</p>
  </li>
  <li>
    <p><code>config.action_controller.perform_caching</code> configures whether the application should perform caching or not. Set to false in development mode, true in production.</p>
  </li>
  <li>
    <p><code>config.action_controller.default_static_extension</code> configures the extension used for cached pages. Defaults to <code>.html</code>.</p>
  </li>
  <li>
    <p><code>config.action_controller.default_charset</code> specifies the default character set for all renders. The default is “utf-8”.</p>
  </li>
  <li>
    <p><code>config.action_controller.logger</code> accepts a logger conforming to the interface of Log4r or the default Ruby Logger class, which is then used to log information from Action Controller. Set to <code>nil</code> to disable logging.</p>
  </li>
  <li>
    <p><code>config.action_controller.request_forgery_protection_token</code> sets the token parameter name for RequestForgery. Calling <code>protect_from_forgery</code> sets it to <code>:authenticity_token</code> by default.</p>
  </li>
  <li>
    <p><code>config.action_controller.allow_forgery_protection</code> enables or disables CSRF protection. By default this is <code>false</code> in test mode and <code>true</code> in all other modes.</p>
  </li>
  <li>
    <p><code>config.action_controller.relative_url_root</code> can be used to tell Rails that you are <a href="configuring.html#deploy-to-a-subdirectory-relative-url-root">deploying to a subdirectory</a>. The default is <code>ENV['RAILS_RELATIVE_URL_ROOT']</code>.</p>
  </li>
  <li>
    <p><code>config.action_controller.permit_all_parameters</code> sets all the parameters for mass assignment to be permitted by default. The default value is <code>false</code>.</p>
  </li>
  <li>
    <p><code>config.action_controller.action_on_unpermitted_parameters</code> enables logging or raising an exception if parameters that are not explicitly permitted are found. Set to <code>:log</code> or <code>:raise</code> to enable. The default value is <code>:log</code> in development and test environments, and <code>false</code> in all other environments.</p>
  </li>
  <li>
    <p><code>config.action_controller.always_permitted_parameters</code> sets a list of whitelisted parameters that are permitted by default. The default values are <code>['controller', 'action']</code>.</p>
  </li>
</ul>

<h3 id="configuring-action-dispatch">Configuring Action Dispatch</h3>

<ul>
  <li>
    <p><code>config.action_dispatch.session_store</code> sets the name of the store for session data. The default is <code>:cookie_store</code>; other valid options include <code>:active_record_store</code>, <code>:mem_cache_store</code> or the name of your own custom class.</p>
  </li>
  <li>
    <p><code>config.action_dispatch.default_headers</code> is a hash with HTTP headers that are set by default in each response. By default, this is defined as:</p>

    <p>~~~ruby
  config.action_dispatch.default_headers = {
    ‘X-Frame-Options’ =&gt; ‘SAMEORIGIN’,
    ‘X-XSS-Protection’ =&gt; ‘1; mode=block’,
    ‘X-Content-Type-Options’ =&gt; ‘nosniff’
  }
  ~~~</p>
  </li>
  <li>
    <p><code>config.action_dispatch.tld_length</code> sets the TLD (top-level domain) length for the application. Defaults to <code>1</code>.</p>
  </li>
  <li>
    <p><code>config.action_dispatch.http_auth_salt</code> sets the HTTP Auth salt value. Defaults
to <code>'http authentication'</code>.</p>
  </li>
  <li>
    <p><code>config.action_dispatch.signed_cookie_salt</code> sets the signed cookies salt value.
Defaults to <code>'signed cookie'</code>.</p>
  </li>
  <li>
    <p><code>config.action_dispatch.encrypted_cookie_salt</code> sets the encrypted cookies salt
value. Defaults to <code>'encrypted cookie'</code>.</p>
  </li>
  <li>
    <p><code>config.action_dispatch.encrypted_signed_cookie_salt</code> sets the signed
encrypted cookies salt value. Defaults to <code>'signed encrypted cookie'</code>.</p>
  </li>
  <li>
    <p><code>config.action_dispatch.perform_deep_munge</code> configures whether <code>deep_munge</code>
method should be performed on the parameters. See <a href="security.html#unsafe-query-generation">Security Guide</a>
for more information. It defaults to true.</p>
  </li>
  <li>
    <p><code>config.action_dispatch.rescue_responses</code> configures what exceptions are assigned to an HTTP status. It accepts a hash and you can specify pairs of exception/status. By default, this is defined as:</p>

    <div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>config.action_dispatch.rescue_responses = {
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActionController::RoutingError</span><span style="color:#710">'</span></span>              =&gt; <span style="color:#A60">:not_found</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">AbstractController::ActionNotFound</span><span style="color:#710">'</span></span>          =&gt; <span style="color:#A60">:not_found</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActionController::MethodNotAllowed</span><span style="color:#710">'</span></span>          =&gt; <span style="color:#A60">:method_not_allowed</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActionController::UnknownHttpMethod</span><span style="color:#710">'</span></span>         =&gt; <span style="color:#A60">:method_not_allowed</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActionController::NotImplemented</span><span style="color:#710">'</span></span>            =&gt; <span style="color:#A60">:not_implemented</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActionController::UnknownFormat</span><span style="color:#710">'</span></span>             =&gt; <span style="color:#A60">:not_acceptable</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActionController::InvalidAuthenticityToken</span><span style="color:#710">'</span></span>  =&gt; <span style="color:#A60">:unprocessable_entity</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActionController::InvalidCrossOriginRequest</span><span style="color:#710">'</span></span> =&gt; <span style="color:#A60">:unprocessable_entity</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActionDispatch::ParamsParser::ParseError</span><span style="color:#710">'</span></span>    =&gt; <span style="color:#A60">:bad_request</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActionController::BadRequest</span><span style="color:#710">'</span></span>                =&gt; <span style="color:#A60">:bad_request</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActionController::ParameterMissing</span><span style="color:#710">'</span></span>          =&gt; <span style="color:#A60">:bad_request</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActiveRecord::RecordNotFound</span><span style="color:#710">'</span></span>                =&gt; <span style="color:#A60">:not_found</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActiveRecord::StaleObjectError</span><span style="color:#710">'</span></span>              =&gt; <span style="color:#A60">:conflict</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActiveRecord::RecordInvalid</span><span style="color:#710">'</span></span>                 =&gt; <span style="color:#A60">:unprocessable_entity</span>,
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ActiveRecord::RecordNotSaved</span><span style="color:#710">'</span></span>                =&gt; <span style="color:#A60">:unprocessable_entity</span>
}
</pre></div>
</div>
    </div>

    <p>Any exceptions that are not configured will be mapped to 500 Internal Server Error.</p>
  </li>
  <li>
    <p><code>ActionDispatch::Callbacks.before</code> takes a block of code to run before the request.</p>
  </li>
  <li>
    <p><code>ActionDispatch::Callbacks.to_prepare</code> takes a block to run after <code>ActionDispatch::Callbacks.before</code>, but before the request. Runs for every request in <code>development</code> mode, but only once for <code>production</code> or environments with <code>cache_classes</code> set to <code>true</code>.</p>
  </li>
  <li>
    <p><code>ActionDispatch::Callbacks.after</code> takes a block of code to run after the request.</p>
  </li>
</ul>

<h3 id="configuring-action-view">Configuring Action View</h3>

<p><code>config.action_view</code> includes a small number of configuration settings:</p>

<ul>
  <li>
    <p><code>config.action_view.field_error_proc</code> provides an HTML generator for displaying errors that come from Active Record. The default is</p>

    <p>~~~ruby
  Proc.new do |html_tag, instance|
    %Q(&lt;div class="field_with_errors"&gt;#{html_tag}&lt;/div&gt;).html_safe
  end
  ~~~</p>
  </li>
  <li>
    <p><code>config.action_view.default_form_builder</code> tells Rails which form builder to use by default. The default is <code>ActionView::Helpers::FormBuilder</code>. If you want your form builder class to be loaded after initialization (so it’s reloaded on each request in development), you can pass it as a <code>String</code></p>
  </li>
  <li>
    <p><code>config.action_view.logger</code> accepts a logger conforming to the interface of Log4r or the default Ruby Logger class, which is then used to log information from Action View. Set to <code>nil</code> to disable logging.</p>
  </li>
  <li>
    <p><code>config.action_view.erb_trim_mode</code> gives the trim mode to be used by ERB. It defaults to <code>'-'</code>, which turns on trimming of tail spaces and newline when using <code>&lt;%= -%&gt;</code> or <code>&lt;%= =%&gt;</code>. See the <a href="http://www.kuwata-lab.com/erubis/users-guide.06.html#topics-trimspaces">Erubis documentation</a> for more information.</p>
  </li>
  <li>
    <p><code>config.action_view.embed_authenticity_token_in_remote_forms</code> allows you to set the default behavior for <code>authenticity_token</code> in forms with <code>:remote =&gt; true</code>. By default it’s set to false, which means that remote forms will not include <code>authenticity_token</code>, which is helpful when you’re fragment-caching the form. Remote forms get the authenticity from the <code>meta</code> tag, so embedding is unnecessary unless you support browsers without JavaScript. In such case you can either pass <code>:authenticity_token =&gt; true</code> as a form option or set this config setting to <code>true</code></p>
  </li>
  <li>
    <p><code>config.action_view.prefix_partial_path_with_controller_namespace</code> determines whether or not partials are looked up from a subdirectory in templates rendered from namespaced controllers. For example, consider a controller named <code>Admin::ArticlesController</code> which renders this template:</p>

    <p>~~~erb
  &lt;%= render @article %&gt;
  ~~~</p>

    <p>The default setting is <code>true</code>, which uses the partial at <code>/admin/articles/_article.erb</code>. Setting the value to <code>false</code> would render <code>/articles/_article.erb</code>, which is the same behavior as rendering from a non-namespaced controller such as <code>ArticlesController</code>.</p>
  </li>
  <li>
    <p><code>config.action_view.raise_on_missing_translations</code> determines whether an error should be raised for missing translations</p>
  </li>
</ul>

<h3 id="configuring-action-mailer">Configuring Action Mailer</h3>

<p>There are a number of settings available on <code>config.action_mailer</code>:</p>

<ul>
  <li>
    <p><code>config.action_mailer.logger</code> accepts a logger conforming to the interface of Log4r or the default Ruby Logger class, which is then used to log information from Action Mailer. Set to <code>nil</code> to disable logging.</p>
  </li>
  <li><code>config.action_mailer.smtp_settings</code> allows detailed configuration for the <code>:smtp</code> delivery method. It accepts a hash of options, which can include any of these options:
    <ul>
      <li><code>:address</code> - Allows you to use a remote mail server. Just change it from its default “localhost” setting.</li>
      <li><code>:port</code> - On the off chance that your mail server doesn’t run on port 25, you can change it.</li>
      <li><code>:domain</code> - If you need to specify a HELO domain, you can do it here.</li>
      <li><code>:user_name</code> - If your mail server requires authentication, set the username in this setting.</li>
      <li><code>:password</code> - If your mail server requires authentication, set the password in this setting.</li>
      <li><code>:authentication</code> - If your mail server requires authentication, you need to specify the authentication type here. This is a symbol and one of <code>:plain</code>, <code>:login</code>, <code>:cram_md5</code>.</li>
    </ul>
  </li>
  <li><code>config.action_mailer.sendmail_settings</code> allows detailed configuration for the <code>sendmail</code> delivery method. It accepts a hash of options, which can include any of these options:
    <ul>
      <li><code>:location</code> - The location of the sendmail executable. Defaults to <code>/usr/sbin/sendmail</code>.</li>
      <li><code>:arguments</code> - The command line arguments. Defaults to <code>-i -t</code>.</li>
    </ul>
  </li>
  <li>
    <p><code>config.action_mailer.raise_delivery_errors</code> specifies whether to raise an error if email delivery cannot be completed. It defaults to true.</p>
  </li>
  <li>
    <p><code>config.action_mailer.delivery_method</code> defines the delivery method and defaults to <code>:smtp</code>. See the <a href="http://guides.rubyonrails.org/action_mailer_basics.html#action-mailer-configuration">configuration section in the Action Mailer guide</a> for more info.</p>
  </li>
  <li>
    <p><code>config.action_mailer.perform_deliveries</code> specifies whether mail will actually be delivered and is true by default. It can be convenient to set it to false for testing.</p>
  </li>
  <li>
    <p><code>config.action_mailer.default_options</code> configures Action Mailer defaults. Use to set options like <code>from</code> or <code>reply_to</code> for every mailer. These default to:</p>

    <p>~~~ruby
  mime_version:  “1.0”,
  charset:       “UTF-8”,
  content_type: “text/plain”,
  parts_order:  [“text/plain”, “text/enriched”, “text/html”]
  ~~~</p>

    <p>Assign a hash to set additional options:</p>

    <p>~~~ruby
  config.action_mailer.default_options = {
    from: “noreply@example.com”
  }
  ~~~</p>
  </li>
  <li>
    <p><code>config.action_mailer.observers</code> registers observers which will be notified when mail is delivered.</p>

    <p>~~~ruby
  config.action_mailer.observers = [“MailObserver”]
  ~~~</p>
  </li>
  <li>
    <p><code>config.action_mailer.interceptors</code> registers interceptors which will be called before mail is sent.</p>

    <p>~~~ruby
  config.action_mailer.interceptors = [“MailInterceptor”]
  ~~~</p>
  </li>
  <li>
    <p><code>config.action_mailer.preview_path</code> specifies the location of mailer previews.</p>

    <p>~~~ruby
  config.action_mailer.preview_path = “#{Rails.root}/lib/mailer_previews”
  ~~~</p>
  </li>
  <li>
    <p><code>config.action_mailer.show_previews</code> enable or disable mailer previews. By default this is <code>true</code> in development.</p>

    <p>~~~ruby
  config.action_mailer.show_previews = false
  ~~~</p>
  </li>
</ul>

<h3 id="configuring-active-support">Configuring Active Support</h3>

<p>There are a few configuration options available in Active Support:</p>

<ul>
  <li>
    <p><code>config.active_support.bare</code> enables or disables the loading of <code>active_support/all</code> when booting Rails. Defaults to <code>nil</code>, which means <code>active_support/all</code> is loaded.</p>
  </li>
  <li>
    <p><code>config.active_support.test_order</code> sets the order that test cases are executed. Possible values are <code>:sorted</code> and <code>:random</code>. Currently defaults to <code>:sorted</code>. In Rails 5.0, the default will be changed to <code>:random</code> instead.</p>
  </li>
  <li>
    <p><code>config.active_support.escape_html_entities_in_json</code> enables or disables the escaping of HTML entities in JSON serialization. Defaults to <code>false</code>.</p>
  </li>
  <li>
    <p><code>config.active_support.use_standard_json_time_format</code> enables or disables serializing dates to ISO 8601 format. Defaults to <code>true</code>.</p>
  </li>
  <li>
    <p><code>config.active_support.time_precision</code> sets the precision of JSON encoded time values. Defaults to <code>3</code>.</p>
  </li>
  <li>
    <p><code>ActiveSupport::Logger.silencer</code> is set to <code>false</code> to disable the ability to silence logging in a block. The default is <code>true</code>.</p>
  </li>
  <li>
    <p><code>ActiveSupport::Cache::Store.logger</code> specifies the logger to use within cache store operations.</p>
  </li>
  <li>
    <p><code>ActiveSupport::Deprecation.behavior</code> alternative setter to <code>config.active_support.deprecation</code> which configures the behavior of deprecation warnings for Rails.</p>
  </li>
  <li>
    <p><code>ActiveSupport::Deprecation.silence</code> takes a block in which all deprecation warnings are silenced.</p>
  </li>
  <li>
    <p><code>ActiveSupport::Deprecation.silenced</code> sets whether or not to display deprecation warnings.</p>
  </li>
</ul>

<h3 id="configuring-a-database">Configuring a Database</h3>

<p>Just about every Rails application will interact with a database. You can connect to the database by setting an environment variable <code>ENV['DATABASE_URL']</code> or by using a configuration file called <code>config/database.yml</code>.</p>

<p>Using the <code>config/database.yml</code> file you can specify all the information needed to access your database:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#606">development</span>:
  <span style="color:#606">adapter</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">postgresql</span></span>
  <span style="color:#606">database</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">blog_development</span></span>
  <span style="color:#606">pool</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5</span></span>
</pre></div>
</div>
</div>

<p>This will connect to the database named <code>blog_development</code> using the <code>postgresql</code> adapter. This same information can be stored in a URL and provided via an environment variable like this:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>&gt; puts <span style="color:#069">ENV</span>[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">DATABASE_URL</span><span style="color:#710">'</span></span>]
<span style="color:#606">postgresql</span>:<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#404">/</span></span>localhost/blog_development?pool=<span style="color:#00D">5</span>
</pre></div>
</div>
</div>

<p>The <code>config/database.yml</code> file contains sections for three different environments in which Rails can run by default:</p>

<ul>
  <li>The <code>development</code> environment is used on your development/local computer as you interact manually with the application.</li>
  <li>The <code>test</code> environment is used when running automated tests.</li>
  <li>The <code>production</code> environment is used when you deploy your application for the world to use.</li>
</ul>

<p>If you wish, you can manually specify a URL inside of your <code>config/database.yml</code></p>

<pre><code>development:
  url: postgresql://localhost/blog_development?pool=5
</code></pre>

<p>The <code>config/database.yml</code> file can contain ERB tags <code>&lt;%= %&gt;</code>. Anything in the tags will be evaluated as Ruby code. You can use this to pull out data from an environment variable or to perform calculations to generate the needed connection information.</p>

<p>TIP: You don’t have to update the database configurations manually. If you look at the options of the application generator, you will see that one of the options is named <code>--database</code>. This option allows you to choose an adapter from a list of the most used relational databases. You can even run the generator repeatedly: <code>cd .. &amp;&amp; rails new blog --database=mysql</code>. When you confirm the overwriting of the <code>config/database.yml</code> file, your application will be configured for MySQL instead of SQLite. Detailed examples of the common database connections are below.</p>

<h3 id="connection-preference">Connection Preference</h3>

<p>Since there are two ways to set your connection, via environment variable it is important to understand how the two can interact.</p>

<p>If you have an empty <code>config/database.yml</code> file but your <code>ENV['DATABASE_URL']</code> is present, then Rails will connect to the database via your environment variable:</p>

<pre><code>$ cat config/database.yml

$ echo $DATABASE_URL
postgresql://localhost/my_database
</code></pre>

<p>If you have a <code>config/database.yml</code> but no <code>ENV['DATABASE_URL']</code> then this file will be used to connect to your database:</p>

<pre><code>$ cat config/database.yml
development:
  adapter: postgresql
  database: my_database
  host: localhost

$ echo $DATABASE_URL
</code></pre>

<p>If you have both <code>config/database.yml</code> and <code>ENV['DATABASE_URL']</code> set then Rails will merge the configuration together. To better understand this we must see some examples.</p>

<p>When duplicate connection information is provided the environment variable will take precedence:</p>

<pre><code>$ cat config/database.yml
development:
  adapter: sqlite3
  database: NOT_my_database
  host: localhost

$ echo $DATABASE_URL
postgresql://localhost/my_database

$ bin/rails runner 'puts ActiveRecord::Base.configurations'
{"development"=&gt;{"adapter"=&gt;"postgresql", "host"=&gt;"localhost", "database"=&gt;"my_database"}}
</code></pre>

<p>Here the adapter, host, and database match the information in <code>ENV['DATABASE_URL']</code>.</p>

<p>If non-duplicate information is provided you will get all unique values, environment variable still takes precedence in cases of any conflicts.</p>

<pre><code>$ cat config/database.yml
development:
  adapter: sqlite3
  pool: 5

$ echo $DATABASE_URL
postgresql://localhost/my_database

$ bin/rails runner 'puts ActiveRecord::Base.configurations'
{"development"=&gt;{"adapter"=&gt;"postgresql", "host"=&gt;"localhost", "database"=&gt;"my_database", "pool"=&gt;5}}
</code></pre>

<p>Since pool is not in the <code>ENV['DATABASE_URL']</code> provided connection information its information is merged in. Since <code>adapter</code> is duplicate, the <code>ENV['DATABASE_URL']</code> connection information wins.</p>

<p>The only way to explicitly not use the connection information in <code>ENV['DATABASE_URL']</code> is to specify an explicit URL connection using the <code>"url"</code> sub key:</p>

<pre><code>$ cat config/database.yml
development:
  url: sqlite3:NOT_my_database

$ echo $DATABASE_URL
postgresql://localhost/my_database

$ bin/rails runner 'puts ActiveRecord::Base.configurations'
{"development"=&gt;{"adapter"=&gt;"sqlite3", "database"=&gt;"NOT_my_database"}}
</code></pre>

<p>Here the connection information in <code>ENV['DATABASE_URL']</code> is ignored, note the different adapter and database name.</p>

<p>Since it is possible to embed ERB in your <code>config/database.yml</code> it is best practice to explicitly show you are using the <code>ENV['DATABASE_URL']</code> to connect to your database. This is especially useful in production since you should not commit secrets like your database password into your source control (such as Git).</p>

<pre><code>$ cat config/database.yml
production:
  url: &lt;%= ENV['DATABASE_URL'] %&gt;
</code></pre>

<p>Now the behavior is clear, that we are only using the connection information in <code>ENV['DATABASE_URL']</code>.</p>

<h4 id="configuring-an-sqlite3-database">Configuring an SQLite3 Database</h4>

<p>Rails comes with built-in support for <a href="http://www.sqlite.org">SQLite3</a>, which is a lightweight serverless database application. While a busy production environment may overload SQLite, it works well for development and testing. Rails defaults to using an SQLite database when creating a new project, but you can always change it later.</p>

<p>Here’s the section of the default configuration file (<code>config/database.yml</code>) with connection information for the development environment:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#606">development</span>:
  <span style="color:#606">adapter</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">sqlite3</span></span>
  <span style="color:#606">database</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">db/development.sqlite3</span></span>
  <span style="color:#606">pool</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5</span></span>
  <span style="color:#606">timeout</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5000</span></span>
</pre></div>
</div>
</div>

<p>NOTE: Rails uses an SQLite3 database for data storage by default because it is a zero configuration database that just works. Rails also supports MySQL and PostgreSQL “out of the box”, and has plugins for many database systems. If you are using a database in a production environment Rails most likely has an adapter for it.</p>

<h4 id="configuring-a-mysql-database">Configuring a MySQL Database</h4>

<p>If you choose to use MySQL instead of the shipped SQLite3 database, your <code>config/database.yml</code> will look a little different. Here’s the development section:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#606">development</span>:
  <span style="color:#606">adapter</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mysql2</span></span>
  <span style="color:#606">encoding</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">utf8</span></span>
  <span style="color:#606">database</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">blog_development</span></span>
  <span style="color:#606">pool</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5</span></span>
  <span style="color:#606">username</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">root</span></span>
  <span style="color:#606">password</span>:
  <span style="color:#606">socket</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/tmp/mysql.sock</span></span>
</pre></div>
</div>
</div>

<p>If your development computer’s MySQL installation includes a root user with an empty password, this configuration should work for you. Otherwise, change the username and password in the <code>development</code> section as appropriate.</p>

<h4 id="configuring-a-postgresql-database">Configuring a PostgreSQL Database</h4>

<p>If you choose to use PostgreSQL, your <code>config/database.yml</code> will be customized to use PostgreSQL databases:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#606">development</span>:
  <span style="color:#606">adapter</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">postgresql</span></span>
  <span style="color:#606">encoding</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">unicode</span></span>
  <span style="color:#606">database</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">blog_development</span></span>
  <span style="color:#606">pool</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5</span></span>
</pre></div>
</div>
</div>

<p>Prepared Statements are enabled by default on PostgreSQL. You can be disable prepared statements by setting <code>prepared_statements</code> to <code>false</code>:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#606">production</span>:
  <span style="color:#606">adapter</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">postgresql</span></span>
  <span style="color:#606">prepared_statements</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
</pre></div>
</div>
</div>

<p>If enabled, Active Record will create up to <code>1000</code> prepared statements per database connection by default. To modify this behavior you can set <code>statement_limit</code> to a different value:</p>

<pre><code>production:
  adapter: postgresql
  statement_limit: 200
</code></pre>

<p>The more prepared statements in use: the more memory your database will require. If your PostgreSQL database is hitting memory limits, try lowering <code>statement_limit</code> or disabling prepared statements.</p>

<h4 id="configuring-an-sqlite3-database-for-jruby-platform">Configuring an SQLite3 Database for JRuby Platform</h4>

<p>If you choose to use SQLite3 and are using JRuby, your <code>config/database.yml</code> will look a little different. Here’s the development section:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#606">development</span>:
  <span style="color:#606">adapter</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">jdbcsqlite3</span></span>
  <span style="color:#606">database</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">db/development.sqlite3</span></span>
</pre></div>
</div>
</div>

<h4 id="configuring-a-mysql-database-for-jruby-platform">Configuring a MySQL Database for JRuby Platform</h4>

<p>If you choose to use MySQL and are using JRuby, your <code>config/database.yml</code> will look a little different. Here’s the development section:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#606">development</span>:
  <span style="color:#606">adapter</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">jdbcmysql</span></span>
  <span style="color:#606">database</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">blog_development</span></span>
  <span style="color:#606">username</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">root</span></span>
  <span style="color:#606">password</span>:
</pre></div>
</div>
</div>

<h4 id="configuring-a-postgresql-database-for-jruby-platform">Configuring a PostgreSQL Database for JRuby Platform</h4>

<p>If you choose to use PostgreSQL and are using JRuby, your <code>config/database.yml</code> will look a little different. Here’s the development section:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#606">development</span>:
  <span style="color:#606">adapter</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">jdbcpostgresql</span></span>
  <span style="color:#606">encoding</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">unicode</span></span>
  <span style="color:#606">database</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">blog_development</span></span>
  <span style="color:#606">username</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">blog</span></span>
  <span style="color:#606">password</span>:
</pre></div>
</div>
</div>

<p>Change the username and password in the <code>development</code> section as appropriate.</p>

<h3 id="creating-rails-environments">Creating Rails Environments</h3>

<p>By default Rails ships with three environments: “development”, “test”, and “production”. While these are sufficient for most use cases, there are circumstances when you want more environments.</p>

<p>Imagine you have a server which mirrors the production environment but is only used for testing. Such a server is commonly called a “staging server”. To define an environment called “staging” for this server, just create a file called <code>config/environments/staging.rb</code>. Please use the contents of any existing file in <code>config/environments</code> as a starting point and make the necessary changes from there.</p>

<p>That environment is no different than the default ones, start a server with <code>rails server -e staging</code>, a console with <code>rails console staging</code>, <code>Rails.env.staging?</code> works, etc.</p>

<h3 id="deploy-to-a-subdirectory-relative-url-root">Deploy to a subdirectory (relative url root)</h3>

<p>By default Rails expects that your application is running at the root
(eg. <code>/</code>). This section explains how to run your application inside a directory.</p>

<p>Let’s assume we want to deploy our application to “/app1”. Rails needs to know
this directory to generate the appropriate routes:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>config.relative_url_root = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/app1</span><span style="color:#710">&quot;</span></span>
</pre></div>
</div>
</div>

<p>alternatively you can set the <code>RAILS_RELATIVE_URL_ROOT</code> environment
variable.</p>

<p>Rails will now prepend “/app1” when generating links.</p>

<h4 id="using-passenger">Using Passenger</h4>

<p>Passenger makes it easy to run your application in a subdirectory. You can find the relevant configuration in the <a href="http://www.modrails.com/documentation/Users%20guide%20Apache.html#deploying_rails_to_sub_uri">Passenger manual</a>.</p>

<h4 id="using-a-reverse-proxy">Using a Reverse Proxy</h4>

<p>Deploying your application using a reverse proxy has definite advantages over traditional deploys. They allow you to have more control over your server by layering the components required by your application.</p>

<p>Many modern web servers can be used as a proxy server to balance third-party elements such as caching servers or application servers.</p>

<p>One such application server you can use is <a href="http://unicorn.bogomips.org/">Unicorn</a> to run behind a reverse proxy.</p>

<p>In this case, you would need to configure the proxy server (NGINX, Apache, etc) to accept connections from your application server (Unicorn). By default Unicorn will listen for TCP connections on port 8080, but you can change the port or configure it to use sockets instead.</p>

<p>You can find more information in the <a href="http://unicorn.bogomips.org/README.html">Unicorn readme</a> and understand the <a href="http://unicorn.bogomips.org/PHILOSOPHY.html">philosophy</a> behind it.</p>

<p>Once you’ve configured the application server, you must proxy requests to it by configuring your web server appropriately. For example your NGINX config may include:</p>

<pre><code>upstream application_server {
  server 0.0.0.0:8080
}

server {
  listen 80;
  server_name localhost;

  root /root/path/to/your_app/public;

  try_files $uri/index.html $uri.html @app;

  location @app {
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_redirect off;
    proxy_pass http://application_server;
  }

  # some other configuration
}
</code></pre>

<p>Be sure to read the <a href="http://nginx.org/en/docs/">NGINX documentation</a> for the most up-to-date information.</p>

<h4 id="considerations-when-deploying-to-a-subdirectory">Considerations when deploying to a subdirectory</h4>

<p>Deploying to a subdirectory in production has implications on various parts of
Rails.</p>

<ul>
  <li>development environment:</li>
  <li>testing environment:</li>
  <li>serving static assets:</li>
  <li>asset pipeline:</li>
</ul>

<h2 id="rails-environment-settings">Rails Environment Settings</h2>

<p>Some parts of Rails can also be configured externally by supplying environment variables. The following environment variables are recognized by various parts of Rails:</p>

<ul>
  <li>
    <p><code>ENV["RAILS_ENV"]</code> defines the Rails environment (production, development, test, and so on) that Rails will run under.</p>
  </li>
  <li>
    <p><code>ENV["RAILS_RELATIVE_URL_ROOT"]</code> is used by the routing code to recognize URLs when you <a href="configuring.html#deploy-to-a-subdirectory-relative-url-root">deploy your application to a subdirectory</a>.</p>
  </li>
  <li>
    <p><code>ENV["RAILS_CACHE_ID"]</code> and <code>ENV["RAILS_APP_VERSION"]</code> are used to generate expanded cache keys in Rails’ caching code. This allows you to have multiple separate caches from the same application.</p>
  </li>
</ul>

<h2 id="using-initializer-files">Using Initializer Files</h2>

<p>After loading the framework and any gems in your application, Rails turns to loading initializers. An initializer is any Ruby file stored under <code>config/initializers</code> in your application. You can use initializers to hold configuration settings that should be made after all of the frameworks and gems are loaded, such as options to configure settings for these parts.</p>

<p>NOTE: You can use subfolders to organize your initializers if you like, because Rails will look into the whole file hierarchy from the initializers folder on down.</p>

<p>TIP: If you have any ordering dependency in your initializers, you can control the load order through naming. Initializer files are loaded in alphabetical order by their path. For example, <code>01_critical.rb</code> will be loaded before <code>02_normal.rb</code>.</p>

<h2 id="initialization-events">Initialization events</h2>

<p>Rails has 5 initialization events which can be hooked into (listed in the order that they are run):</p>

<ul>
  <li>
    <p><code>before_configuration</code>: This is run as soon as the application constant inherits from <code>Rails::Application</code>. The <code>config</code> calls are evaluated before this happens.</p>
  </li>
  <li>
    <p><code>before_initialize</code>: This is run directly before the initialization process of the application occurs with the <code>:bootstrap_hook</code> initializer near the beginning of the Rails initialization process.</p>
  </li>
  <li>
    <p><code>to_prepare</code>: Run after the initializers are run for all Railties (including the application itself), but before eager loading and the middleware stack is built. More importantly, will run upon every request in <code>development</code>, but only once (during boot-up) in <code>production</code> and <code>test</code>.</p>
  </li>
  <li>
    <p><code>before_eager_load</code>: This is run directly before eager loading occurs, which is the default behavior for the <code>production</code> environment and not for the <code>development</code> environment.</p>
  </li>
  <li>
    <p><code>after_initialize</code>: Run directly after the initialization of the application, after the application initializers in <code>config/initializers</code> are run.</p>
  </li>
</ul>

<p>To define an event for these hooks, use the block syntax within a <code>Rails::Application</code>, <code>Rails::Railtie</code> or <code>Rails::Engine</code> subclass:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">YourApp</span>
  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Application</span> &lt; <span style="color:#036;font-weight:bold">Rails</span>::<span style="color:#036;font-weight:bold">Application</span>
    config.before_initialize <span style="color:#080;font-weight:bold">do</span>
      <span style="color:#777"># initialization code goes here</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Alternatively, you can also do it through the <code>config</code> method on the <code>Rails.application</code> object:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">Rails</span>.application.config.before_initialize <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># initialization code goes here</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>WARNING: Some parts of your application, notably routing, are not yet set up at the point where the <code>after_initialize</code> block is called.</p>

<h3 id="railsrailtieinitializer"><code>Rails::Railtie#initializer</code></h3>

<p>Rails has several initializers that run on startup that are all defined by using the <code>initializer</code> method from <code>Rails::Railtie</code>. Here’s an example of the <code>set_helpers_path</code> initializer from Action Controller:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>initializer <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">action_controller.set_helpers_path</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">do</span> |app|
  <span style="color:#036;font-weight:bold">ActionController</span>::<span style="color:#036;font-weight:bold">Helpers</span>.helpers_path = app.helpers_paths
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>The <code>initializer</code> method takes three arguments with the first being the name for the initializer and the second being an options hash (not shown here) and the third being a block. The <code>:before</code> key in the options hash can be specified to specify which initializer this new initializer must run before, and the <code>:after</code> key will specify which initializer to run this initializer <em>after</em>.</p>

<p>Initializers defined using the <code>initializer</code> method will be run in the order they are defined in, with the exception of ones that use the <code>:before</code> or <code>:after</code> methods.</p>

<p>WARNING: You may put your initializer before or after any other initializer in the chain, as long as it is logical. Say you have 4 initializers called “one” through “four” (defined in that order) and you define “four” to go <em>before</em> “four” but <em>after</em> “three”, that just isn’t logical and Rails will not be able to determine your initializer order.</p>

<p>The block argument of the <code>initializer</code> method is the instance of the application itself, and so we can access the configuration on it by using the <code>config</code> method as done in the example.</p>

<p>Because <code>Rails::Application</code> inherits from <code>Rails::Railtie</code> (indirectly), you can use the <code>initializer</code> method in <code>config/application.rb</code> to define initializers for the application.</p>

<h3 id="initializers">Initializers</h3>

<p>Below is a comprehensive list of all the initializers found in Rails in the order that they are defined (and therefore run in, unless otherwise stated).</p>

<ul>
  <li>
    <p><code>load_environment_hook</code> Serves as a placeholder so that <code>:load_environment_config</code> can be defined to run before it.</p>
  </li>
  <li>
    <p><code>load_active_support</code> Requires <code>active_support/dependencies</code> which sets up the basis for Active Support. Optionally requires <code>active_support/all</code> if <code>config.active_support.bare</code> is un-truthful, which is the default.</p>
  </li>
  <li>
    <p><code>initialize_logger</code> Initializes the logger (an <code>ActiveSupport::Logger</code> object) for the application and makes it accessible at <code>Rails.logger</code>, provided that no initializer inserted before this point has defined <code>Rails.logger</code>.</p>
  </li>
  <li>
    <p><code>initialize_cache</code> If <code>Rails.cache</code> isn’t set yet, initializes the cache by referencing the value in <code>config.cache_store</code> and stores the outcome as <code>Rails.cache</code>. If this object responds to the <code>middleware</code> method, its middleware is inserted before <code>Rack::Runtime</code> in the middleware stack.</p>
  </li>
  <li>
    <p><code>set_clear_dependencies_hook</code> Provides a hook for <code>active_record.set_dispatch_hooks</code> to use, which will run before this initializer. This initializer - which runs only if <code>cache_classes</code> is set to <code>false</code> - uses <code>ActionDispatch::Callbacks.after</code> to remove the constants which have been referenced during the request from the object space so that they will be reloaded during the following request.</p>
  </li>
  <li>
    <p><code>initialize_dependency_mechanism</code> If <code>config.cache_classes</code> is true, configures <code>ActiveSupport::Dependencies.mechanism</code> to <code>require</code> dependencies rather than <code>load</code> them.</p>
  </li>
  <li>
    <p><code>bootstrap_hook</code> Runs all configured <code>before_initialize</code> blocks.</p>
  </li>
  <li>
    <p><code>i18n.callbacks</code> In the development environment, sets up a <code>to_prepare</code> callback which will call <code>I18n.reload!</code> if any of the locales have changed since the last request. In production mode this callback will only run on the first request.</p>
  </li>
  <li>
    <p><code>active_support.deprecation_behavior</code> Sets up deprecation reporting for environments, defaulting to <code>:log</code> for development, <code>:notify</code> for production and <code>:stderr</code> for test. If a value isn’t set for <code>config.active_support.deprecation</code> then this initializer will prompt the user to configure this line in the current environment’s <code>config/environments</code> file. Can be set to an array of values.</p>
  </li>
  <li>
    <p><code>active_support.initialize_time_zone</code> Sets the default time zone for the application based on the <code>config.time_zone</code> setting, which defaults to “UTC”.</p>
  </li>
  <li>
    <p><code>active_support.initialize_beginning_of_week</code> Sets the default beginning of week for the application based on <code>config.beginning_of_week</code> setting, which defaults to <code>:monday</code>.</p>
  </li>
  <li>
    <p><code>action_dispatch.configure</code> Configures the <code>ActionDispatch::Http::URL.tld_length</code> to be set to the value of <code>config.action_dispatch.tld_length</code>.</p>
  </li>
  <li>
    <p><code>action_view.set_configs</code> Sets up Action View by using the settings in <code>config.action_view</code> by <code>send</code>‘ing the method names as setters to <code>ActionView::Base</code> and passing the values through.</p>
  </li>
  <li>
    <p><code>action_controller.logger</code> Sets <code>ActionController::Base.logger</code> - if it’s not already set - to <code>Rails.logger</code>.</p>
  </li>
  <li>
    <p><code>action_controller.initialize_framework_caches</code> Sets <code>ActionController::Base.cache_store</code> - if it’s not already set - to <code>Rails.cache</code>.</p>
  </li>
  <li>
    <p><code>action_controller.set_configs</code> Sets up Action Controller by using the settings in <code>config.action_controller</code> by <code>send</code>‘ing the method names as setters to <code>ActionController::Base</code> and passing the values through.</p>
  </li>
  <li>
    <p><code>action_controller.compile_config_methods</code> Initializes methods for the config settings specified so that they are quicker to access.</p>
  </li>
  <li>
    <p><code>active_record.initialize_timezone</code> Sets <code>ActiveRecord::Base.time_zone_aware_attributes</code> to true, as well as setting <code>ActiveRecord::Base.default_timezone</code> to UTC. When attributes are read from the database, they will be converted into the time zone specified by <code>Time.zone</code>.</p>
  </li>
  <li>
    <p><code>active_record.logger</code> Sets <code>ActiveRecord::Base.logger</code> - if it’s not already set - to <code>Rails.logger</code>.</p>
  </li>
  <li>
    <p><code>active_record.set_configs</code> Sets up Active Record by using the settings in <code>config.active_record</code> by <code>send</code>‘ing the method names as setters to <code>ActiveRecord::Base</code> and passing the values through.</p>
  </li>
  <li>
    <p><code>active_record.initialize_database</code> Loads the database configuration (by default) from <code>config/database.yml</code> and establishes a connection for the current environment.</p>
  </li>
  <li>
    <p><code>active_record.log_runtime</code> Includes <code>ActiveRecord::Railties::ControllerRuntime</code> which is responsible for reporting the time taken by Active Record calls for the request back to the logger.</p>
  </li>
  <li>
    <p><code>active_record.set_dispatch_hooks</code> Resets all reloadable connections to the database if <code>config.cache_classes</code> is set to <code>false</code>.</p>
  </li>
  <li>
    <p><code>action_mailer.logger</code> Sets <code>ActionMailer::Base.logger</code> - if it’s not already set - to <code>Rails.logger</code>.</p>
  </li>
  <li>
    <p><code>action_mailer.set_configs</code> Sets up Action Mailer by using the settings in <code>config.action_mailer</code> by <code>send</code>‘ing the method names as setters to <code>ActionMailer::Base</code> and passing the values through.</p>
  </li>
  <li>
    <p><code>action_mailer.compile_config_methods</code> Initializes methods for the config settings specified so that they are quicker to access.</p>
  </li>
  <li>
    <p><code>set_load_path</code> This initializer runs before <code>bootstrap_hook</code>. Adds the <code>vendor</code>, <code>lib</code>, all directories of <code>app</code> and any paths specified by <code>config.load_paths</code> to <code>$LOAD_PATH</code>.</p>
  </li>
  <li>
    <p><code>set_autoload_paths</code> This initializer runs before <code>bootstrap_hook</code>. Adds all sub-directories of <code>app</code> and paths specified by <code>config.autoload_paths</code> to <code>ActiveSupport::Dependencies.autoload_paths</code>.</p>
  </li>
  <li>
    <p><code>add_routing_paths</code> Loads (by default) all <code>config/routes.rb</code> files (in the application and railties, including engines) and sets up the routes for the application.</p>
  </li>
  <li>
    <p><code>add_locales</code> Adds the files in <code>config/locales</code> (from the application, railties and engines) to <code>I18n.load_path</code>, making available the translations in these files.</p>
  </li>
  <li>
    <p><code>add_view_paths</code> Adds the directory <code>app/views</code> from the application, railties and engines to the lookup path for view files for the application.</p>
  </li>
  <li>
    <p><code>load_environment_config</code> Loads the <code>config/environments</code> file for the current environment.</p>
  </li>
  <li>
    <p><code>append_asset_paths</code> Finds asset paths for the application and all attached railties and keeps a track of the available directories in <code>config.static_asset_paths</code>.</p>
  </li>
  <li>
    <p><code>prepend_helpers_path</code> Adds the directory <code>app/helpers</code> from the application, railties and engines to the lookup path for helpers for the application.</p>
  </li>
  <li>
    <p><code>load_config_initializers</code> Loads all Ruby files from <code>config/initializers</code> in the application, railties and engines. The files in this directory can be used to hold configuration settings that should be made after all of the frameworks are loaded.</p>
  </li>
  <li>
    <p><code>engines_blank_point</code> Provides a point-in-initialization to hook into if you wish to do anything before engines are loaded. After this point, all railtie and engine initializers are run.</p>
  </li>
  <li>
    <p><code>add_generator_templates</code> Finds templates for generators at <code>lib/templates</code> for the application, railties and engines and adds these to the <code>config.generators.templates</code> setting, which will make the templates available for all generators to reference.</p>
  </li>
  <li>
    <p><code>ensure_autoload_once_paths_as_subset</code> Ensures that the <code>config.autoload_once_paths</code> only contains paths from <code>config.autoload_paths</code>. If it contains extra paths, then an exception will be raised.</p>
  </li>
  <li>
    <p><code>add_to_prepare_blocks</code> The block for every <code>config.to_prepare</code> call in the application, a railtie or engine is added to the <code>to_prepare</code> callbacks for Action Dispatch which will be run per request in development, or before the first request in production.</p>
  </li>
  <li>
    <p><code>add_builtin_route</code> If the application is running under the development environment then this will append the route for <code>rails/info/properties</code> to the application routes. This route provides the detailed information such as Rails and Ruby version for <code>public/index.html</code> in a default Rails application.</p>
  </li>
  <li>
    <p><code>build_middleware_stack</code> Builds the middleware stack for the application, returning an object which has a <code>call</code> method which takes a Rack environment object for the request.</p>
  </li>
  <li>
    <p><code>eager_load!</code> If <code>config.eager_load</code> is true, runs the <code>config.before_eager_load</code> hooks and then calls <code>eager_load!</code> which will load all <code>config.eager_load_namespaces</code>.</p>
  </li>
  <li>
    <p><code>finisher_hook</code> Provides a hook for after the initialization of process of the application is complete, as well as running all the <code>config.after_initialize</code> blocks for the application, railties and engines.</p>
  </li>
  <li>
    <p><code>set_routes_reloader</code> Configures Action Dispatch to reload the routes file using <code>ActionDispatch::Callbacks.to_prepare</code>.</p>
  </li>
  <li>
    <p><code>disable_dependency_loading</code> Disables the automatic dependency loading if the <code>config.eager_load</code> is set to true.</p>
  </li>
</ul>

<h2 id="database-pooling">Database pooling</h2>

<p>Active Record database connections are managed by <code>ActiveRecord::ConnectionAdapters::ConnectionPool</code> which ensures that a connection pool synchronizes the amount of thread access to a limited number of database connections. This limit defaults to 5 and can be configured in <code>database.yml</code>.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#606">development</span>:
  <span style="color:#606">adapter</span>: sqlite3
  <span style="color:#606">database</span>: db/development.sqlite3
  <span style="color:#606">pool</span>: <span style="color:#00D">5</span>
  <span style="color:#606">timeout</span>: <span style="color:#00D">5000</span>
</pre></div>
</div>
</div>

<p>Since the connection pooling is handled inside of Active Record by default, all application servers (Thin, mongrel, Unicorn etc.) should behave the same. Initially, the database connection pool is empty and it will create additional connections as the demand for them increases, until it reaches the connection pool limit.</p>

<p>Any one request will check out a connection the first time it requires access to the database, after which it will check the connection back in, at the end of the request, meaning that the additional connection slot will be available again for the next request in the queue.</p>

<p>If you try to use more connections than are available, Active Record will block
and wait for a connection from the pool. When it cannot get connection, a timeout
error similar to given below will be thrown.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">ActiveRecord</span>::<span style="color:#036;font-weight:bold">ConnectionTimeoutError</span> - could <span style="color:#080;font-weight:bold">not</span> obtain a database connection within <span style="color:#00D">5</span> seconds. The max pool size is currently <span style="color:#00D">5</span>; consider increasing <span style="color:#606">it</span>:
</pre></div>
</div>
</div>

<p>If you get the above error, you might want to increase the size of connection
pool by incrementing the <code>pool</code> option in <code>database.yml</code></p>

<p>NOTE. If you are running in a multi-threaded environment, there could be a chance that several threads may be accessing multiple connections simultaneously. So depending on your current request load, you could very well have multiple threads contending for a limited amount of connections.</p>

<h2 id="custom-configuration">Custom configuration</h2>

<p>You can configure your own code through the Rails configuration object with custom configuration. It works like this:</p>

<p>~~~ruby
  config.x.payment_processing.schedule = :daily
  config.x.payment_processing.retries  = 3
  config.x.super_debugger = true
  ~~~</p>

<p>These configuration points are then available through the configuration object:</p>

<p>~~~ruby
  Rails.configuration.x.payment_processing.schedule # =&gt; :daily
  Rails.configuration.x.payment_processing.retries  # =&gt; 3
  Rails.configuration.x.super_debugger              # =&gt; true
  Rails.configuration.x.super_debugger.not_set      # =&gt; nil
  ~~~</p>

  </div>
</body>
</html>
